<%- include("../../views/partials/user/header") %>

<!-- SweetAlert2 and jQuery -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
    .breadcrumb a {
        text-decoration: none;
        color: inherit;
    }
    .breadcrumb a:hover {
        color: #007bff;
        text-decoration: underline;
    }
    .wishlist-icon i {
      transition: color 0.3s ease;
    }
    .wishlist-icon:hover i,
    .wishlist-icon.selected i {
      color: red;
    }
    .zoom-container {
      overflow: hidden;
      text-align: center;
    }
    .zoom-image {
      max-height: 400px;
      object-fit: contain;
      transition: transform 0.3s ease;
    }
</style>

<!-- Breadcrumb -->
<nav class="container mt-4" aria-label="breadcrumb">
    <ol class="breadcrumb bg-light p-2 rounded">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item">
            <a href="/filter?category=<%= product.category._id %>">
                <%= product.category.categoryName %>
            </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            <%= product.productName %>
        </li>
    </ol>
</nav>

<main class="container-fluid my-5">
  <div class="row">
    <!-- Product Image and Thumbnails -->
    <div class="col-md-6">
      <div class="zoom-container text-center mb-4">
        <img id="mainZoomImg" src="<%= product.productImage[0] %>" alt="<%= product.productName %>" class="img-fluid zoom-image" />
      </div>

      <div class="d-flex justify-content-center gap-3">
        <% product.productImage.forEach((img) => { %>
        <a href="#" onclick="changeMainImage('<%= img %>'); return false;">
          <img src="<%= img %>" class="img-fluid border p-1" style="height: 60px;" />
        </a>
        <% }) %>
      </div>

      <section class="mt-5 ms-5">
        <h4>Product Details</h4>
        <hr />
        <p><strong>Description</strong><br><%= product.description %></p>
      </section>
    </div>

    <!-- Product Info -->
    <div class="col-md-6">
      <h2><%= product.productName %></h2>
      <p class="text-muted mb-1"><strong>Brand:</strong> productbrand</p>
      <p class="text-muted mb-1">
        <strong>Pack Size:</strong> <%= product.productQuantity %> <%= product.unit %>
      </p>

      <div class="mb-3 d-flex align-items-center justify-content-between">
        <div>
          <span class="h4 fw-bold text-success">
            ₹ <%= product.price - (product.price * product.effectiveDiscount / 100) %>
          </span>

          <% if (product.price && product.effectiveDiscount) { %>
          <small class="text-muted text-decoration-line-through ms-2">
            MRP ₹<%= product.price %>
          </small>
          <span class="badge bg-success ms-2">
            <%= product.effectiveDiscount %>% off
          </span>
          <% } %>
        </div>
      </div>

      <div class="d-flex align-items-center mb-3">
        <button class="btn btn-outline-danger" type="button" onclick="decreaseQty('qty')">-</button>
        <input type="text" id="qty" value="1" class="form-control text-center mx-2" style="width: 60px;" readonly />
        <button class="btn btn-outline-success" type="button" onclick="increaseQty('qty','<%= product.stock %>')">+</button>
      </div>

      <div class="d-flex align-items-center gap-2 mb-3">
        <a class="btn text-light btn-primary" href="#" onclick="addToCart('<%= product._id %>', 'qty')">Add to Cart</a>
        <button class="btn btn-outline-secondary wishlist-icon  <%= product.inWishlist ? 'selected' : '' %>" onclick="addToWishlist('<%= product._id %>', this)" title="Add to Wishlist">
          <i class="fa fa-heart"></i>
        </button>
      </div>

      <input type="hidden" id="stock" value="<%= product.stock %>">
      <% if (product.stock === 0) { %>
      <p class="text-danger">Out of Stock</p>
      <% } else if (product.stock <= 10) { %>
      <p class="text-danger">Only <%= product.stock %> left in Stock</p>
      <% } else { %>
      <p class="text-success">In Stock</p>
      <% } %>

      <h5 class="mt-4">Why shop from Shopnow?</h5>
      <ul class="list-unstyled mt-3">
        <li class="d-flex mb-3">
          <div class="me-3"><svg width="32" height="32"><use xlink:href="#check"></use></svg></div>
          <div><strong>Superfast Delivery</strong><br />Get your order delivered to your doorstep at the earliest.</div>
        </li>
        <li class="d-flex mb-3">
          <div class="me-3"><svg width="32" height="32"><use xlink:href="#link"></use></svg></div>
          <div><strong>Best Prices & Offers</strong><br />Best price destination with offers directly from manufacturers.</div>
        </li>
        <li class="d-flex">
          <div class="me-3"><svg width="32" height="32"><use xlink:href="#calendar"></use></svg></div>
          <div><strong>Wide Assortment</strong><br />Choose from 5000+ products across food, personal care, household & more.</div>
        </li>
      </ul>
    </div>
  </div>
</main>

<!-- Zoom Script -->
<script>
  function changeMainImage(src) {
    document.querySelector(".zoom-image").src = src;
  }

  const zoomContainer = document.querySelector(".zoom-container");
  const zoomImage = document.querySelector(".zoom-image");

  zoomContainer.addEventListener("mousemove", function (e) {
    const x = e.offsetX;
    const y = e.offsetY;
    const width = zoomContainer.offsetWidth;
    const height = zoomContainer.offsetHeight;

    const xPercent = (x / width) * 100;
    const yPercent = (y / height) * 100;

    zoomImage.style.transformOrigin = `${xPercent}% ${yPercent}%`;
    zoomImage.style.transform = "scale(1.8)";
  });

  zoomContainer.addEventListener("mouseleave", function () {
    zoomImage.style.transform = "scale(1)";
  });
</script>

<%- include("../../views/partials/user/footer") %>